<html>
<head>
    <style>
        html, body {
            font-family: Lato,Helvetica,sans-serif;
            margin: 0px;
            width: 100vw;
            height: 100vh;
            background-color: black;
        }
        .video {
            width: 100%;
            height: 100%;
        }
        .fullscreen {
            width: 100%;
            height: 100%;
            background-color: black;
        }
        .hidden {
            visibility: hidden;
        }
    </style>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>    
</head>
<body>
    <a id="overlay">
        <div class="fullscreen">
            <center>
                <div style="padding-top: 40vh;">
                    <h1 style="color:white;">Press A to play</h1>
                </div>
            </center>
        </div>
    </a>
    <video id="video" controls class="video hidden"></video>
<script>

document.getElementById("overlay").onclick = function(){
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const streamurl = urlParams.get('streamurl')

    document.getElementById("overlay").remove()
    document.getElementById("video").classList.remove("hidden");
    playStreamfromUrl(streamurl),
    document.getElementById("video").play()


}

var playStreamfromUrl = function(url){
    var videoSrc = url;
    var video = document.getElementById('video');
    if (Hls.isSupported()) {
        var hls = new Hls();
        hls.loadSource(videoSrc);
        hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
            video.play()
        });
        hls.attachMedia(video);
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
    } else {
        alert("no support");
    }
}

var gamepadFunction = function(e) {
  var gp = navigator.getGamepads()[e.gamepad.index];
  var gpcheck = setInterval(function(){
    gp.buttons.forEach(button => {
        if (button.pressed) {
            document.getElementById("overlay").click();
            clearInterval(gpcheck);
            window.removeEventListener("gamepadconnected", gamepadFunction);
        }
    });
  }, 100)
}
window.addEventListener("gamepadconnected", gamepadFunction);


</script>
</body>
</html>